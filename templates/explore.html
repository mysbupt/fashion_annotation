<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="static/favicon.ico">

    <title>MMKG Annotation System</title>

    <!-- Bootstrap core CSS -->
    <link href="static/css/signin.css" rel="stylesheet">
    <link href="static/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="static/css/bootstrap-datetimepicker.min.css" />

    <!-- Custom styles for this template -->
    <script src="static/js/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script type="text/javascript" src="static/js/moment.min.js"></script>
    <script src="static/js/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="static/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script type="text/javascript" src="static/js/bootstrap-datetimepicker.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
      <a class="navbar-brand" href="/index">MMKG Annotation</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    
      <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
          <li class="nav-item active">
            <a class="nav-link" href="/explore">Explore<span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
             <button class="btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#myModal">Filter</button>
          </li>
        </ul>
        <span class="navbar-text navbar-right">{{username}} </span>
        <a class="nav-link navbar-right" href="/logout">Logout</a>
      </div>
    </nav>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="myModalLabel">Image Filters</h4>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            	&times;
            </button>
          </div>
          <div class="modal-body">
            <div class="container">
                <div class='col-md-5'>
                    <div class="form-group">
                        <div class='input-group date' id='datetimepicker6'>
                            <input type='text' class="form-control" />
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class='col-md-5'>
                    <div class="form-group">
                        <div class='input-group date' id='datetimepicker7'>
                            <input type='text' class="form-control" />
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                $(function () {
                    $('#datetimepicker6').datetimepicker();
                    $('#datetimepicker7').datetimepicker({
                        useCurrent: false //Important! See issue #1075
                    });
                    $("#datetimepicker6").on("dp.change", function (e) {
                        $('#datetimepicker7').data("DateTimePicker").minDate(e.date);
                    });
                    $("#datetimepicker7").on("dp.change", function (e) {
                        $('#datetimepicker6').data("DateTimePicker").maxDate(e.date);
                    });
                });
            </script>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Submit</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal -->
    </div>

    <div id="app"> 
      <waterfall
        :line="line"
        :line-gap="400"
        :min-line-gap="400"
        :max-line-gap="420"
        :watch="items"
        @reflowed="reflowed"
        ref="waterfall"
      >
        <!-- each component is wrapped by a waterfall slot -->
        <waterfall-slot
          v-for="(item, index) in items"
          :width="item.width"
          :height="item.height"
          :order="index"
          :key="item.index"
          move-class="item-move"
        >
          <img class="item" :width="item.width" :height="item.height" :alt="item.index" :src="item.src">
        </waterfall-slot>
      </waterfall>
    </div>
    <script src="static/js/vue.min.js"></script>
    <script src="static/js/vue-waterfall.min.js"></script>
    <script src="static/js/axios.min.js"></script>
    <script src="static/js/item-factory.js"></script>
    <script>
      var app = new Vue({
        el: '#app',
        components: {
          'waterfall': Waterfall.waterfall,
          'waterfall-slot': Waterfall.waterfallSlot
        },
        mounted: function () {this.addItems()},
        data: {
          line: 'h',
          items: [],
          isBusy: false,
          lastIndex: 0
        },
        methods: {
          addItems: function () {
            if (!this.isBusy && this.items.length < 5000) {
              this.isBusy = true
              var that = this
              ItemFactory.get(50, this.lastIndex).then(function (response) {
                for (var i = 0; i < response.data.length; i++) {
                  response.data[i].index = that.lastIndex++
                  response.data[i].width = 380 
                  response.data[i].height = 380
                }
                that.items = that.items.concat(response.data)
              })
            }
          },
          reflowed: function () {
            this.isBusy = false
          }
        }
      })

      window.addEventListener('scroll', function () {
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop
        if (scrollTop + window.innerHeight >= document.body.clientHeight) {
          app.addItems()
        }
      })

    </script>

  </body>
</html>  
