<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="i-icon" href="../static/favi-icon.ico">
    <title>MMKG Annotation System</title>
    <link href="../static/css/signin.css" rel="stylesheet">
    <link href="../static/css/style.css" rel="stylesheet">
    <link href="../static/css/ivew.css" rel="stylesheet">
    <link href="../static/css/explore.css" rel="stylesheet">
  </head>

  <body>
    <div id="app">
      <i-menu mode="horizontal" :theme="'dark'" active-name="1" class='mmkg-header'>
        <i-menu-item name="1" class='logo'>
          <a class="navbar-brand" href="/index">MMKG Annotation</a>
        </i-menu-item>
        <i-menu-item name="2">
          <i-button type="primary" class='filter' @click="filter">Filter</i-button>
        </i-menu-item>
        <i-menu-item name="3">
          <i-button type="primary" class='filter'>Setting(unavailable)</i-button>
        </i-menu-item>
        <i-menu-item name="4" class='login'>
          <!-- <span class="navbar-text navbar-right">{{username}} </span> -->
          <span class="navbar-text navbar-right">{{username}}</span>
          <a class="nav-link navbar-right" href="/logout">Logout</a>
        </i-menu-item>
      </i-menu>
      <div class='content'>
        <div class='imgs-box'>
          <i-col :lg='config.layouts' v-for="(item, index) in items">
              <Poptip trigger="hover" placement="right"  class="img-container">
                  <img :width="item.width" :height="item.height" :alt="item.index" :src="item.src">
                  <span class='bounding-box' v-for="position in item.bounding_box" v-bind:style="{left: position.left,width: position.width,top: position.top,height: position.height}">
                  </span>
                  <div class="api" slot="content">
                  </div>
              </Poptip>
            <div >
            </div>
          </i-col>
        </div>
        <Page :page-size='config.batch' :current="config.page" :total="pages.count" show-elevator show-total @on-change='pageChange' @on-page-size-change='pageSizeChange'></Page>
      </div>
      <Modal v-model="modalConfig.show" :mask-closable="modalConfig.maskClosable" :loading="modalConfig.loading" title="Filter Modal"
        class='filter-modal' @on-ok="filterConfirm">
        <Row>
          <i-col span="12" class='left'>
            <span>Start Time</span>
          </i-col>
          <i-col span="12" class='right'>
            <date-picker type="datetime" placeholder="Select time" @on-change='startTimeChange'></date-picker>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>End Time</span>
          </i-col>
          <i-col span="12" class='right'>
            <date-picker type="datetime" placeholder="Select time" @on-change='endTimeChange'></date-picker>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Longitude</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-col span="10">
              <input-number v-model='filters.location.longitude[0]' :min="-180" :max="180" class='small'></input-number>
            </i-col>
            <i-col span="2" class='text'>
              to
            </i-col>
            <i-col span="10">
              <input-number v-model='filters.location.longitude[1]' :min="-180" :max="180" class='small'></input-number>
            </i-col>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Latitude</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-col span="10">
              <input-number v-model='filters.location.latitude[0]' :min="-90" :max="90" class='small'></input-number>
            </i-col>
            <i-col span="2" class='text'>
              to
            </i-col>
            <i-col span="10">
              <input-number v-model='filters.location.latitude[1]' :min="-90" :max="90" class='small'></input-number>
            </i-col>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Country</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-input placeholder="specify country" v-model='filters.location.name'></i-input>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Hashtags</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-input placeholder="multi-tags splited by '|'" v-model='filters.hashtags'></i-input>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Num of Persons</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-col span="10">
              <input-number v-model='filters.persons[0]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
            <i-col span="2" class='text'>
              to
            </i-col>
            <i-col span="10">
              <input-number v-model='filters.persons[1]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Num of Faces</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-col span="10">
              <input-number v-model='filters.faces[0]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
            <i-col span="2" class='text'>
              to
            </i-col>
            <i-col span="10">
              <input-number v-model='filters.faces[1]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Num of Likes</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-col span="10">
              <input-number v-model='filters.likes[0]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
            <i-col span="2" class='text'>
              to
            </i-col>
            <i-col span="10">
              <input-number v-model='filters.likes[1]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Num of Comments</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-col span="10">
              <input-number v-model='filters.comments[0]' :min="0" class='small' :precision='0'></input-number>
            </i-col>
            <i-col span="2" class='text'>
              to
            </i-col>
            <i-col span="10">
              <input-number v-model='filters.comments[1]' :min="filters.comments[0] || 0" class='small' :precision='0'></input-number>
            </i-col>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Request Batch</span>
          </i-col>
          <i-col span="12" class='right'>
            <input-number v-model='config.batch' :min="1" :precision='0'></input-number>
          </i-col>
        </Row>
        <Row>
          <i-col span="12" class='left'>
            <span>Posters</span>
          </i-col>
          <i-col span="12" class='right'>
            <i-input placeholder="multi-posters splited by '|'" v-model='filters.bloggers'></i-input>
          </i-col>
        </Row>
      </Modal>
    </div>
    <script src="../static/js/vue.min.js"></script>
    <script src="../static/js/axios.min.js"></script>
    <script src="../static/js/ivew.min.js"></script>
    <script>
      var app = new Vue({
        el: '#app',
        components: {},
        mounted: function () {
          this.getItems();
        },
        data: {
          config: {
            layouts: 6,
            batch: 50,
            page: 1
          },
          items: [],
          pages: {},
          modalConfig: {
            title: 'Filter Modal',
            show: false,
            maskClosable: false,
            loading: true,
          },
          filters: {
            time: ['', ''],
            location: {
              name: "",
              longitude: ['', ''],
              latitude: ['', ''],
            },
            hashtags: '',
            persons: ['', ''],
            faces: ['', ''],
            likes: ['', ''],
            comments: ['', ''],
            bloggers: '',
          }
        },
        methods: {
          getItems: function () {
            /**
             * 把hashTags bloggers 分割成数组  分隔符 |
             */
            let params = Object.assign({},this.filters)
            this.formatVerticalBar(['hashtags', 'bloggers'],params);
            let data = {
              filters: params,
              page: this.config
            }
            console.log(data)
            /**
             * mock/index.json  是本地mock数据  真正测试时需要修改为线上服务器路径
            */
            //axios.get('/mock/index.json',data).then((response)=> {
            axios.post('/get_items',data).then((response)=> {
              let data = response.data.data;
              this.items = data;
              this.pages = response.data.pages;
              this.modalConfig.show = false;
            })
          },
          filter: function () {
            this.modalConfig.show = true;
          },
          filterConfirm: function () {
            console.log(this.filters)
            this.config.page = 1;
            this.getItems()
          },
          formatVerticalBar: function (data,target) {
            data.forEach((item, index) => {
              target[item] = target[item].split('|')
              let temp = target[item];
              temp.forEach((item, index) => {
                temp[index] = item.trim()
              })
            })
          },
          pageChange: function (page) {
            /**
             *page 当前选中页数
             */
            console.log(page)
            this.config.page = page;
            this.getItems();
          },
          pageSizeChange: function (size) {
            /**
             *size 每页显示条数
             */
            console.log(size)
            this.config.batch = size;
            this.config.page = 1;
            this.getItems();
          },
          startTimeChange: function (data) {
            this.filters.time[0] = data;
            console.log(this.filters.time[0])
          },
          endTimeChange: function (data) {
            this.filters.time[1] = data;
            console.log(this.filters.time[1])
          }
        }
      })

    </script>

  </body>

</html>
